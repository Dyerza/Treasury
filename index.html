<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DYERZ.LTD Finance</title>
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Financial OS with Smart Input">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" id="app-manifest">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/5501/5501375.png">

    <!-- LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/auto-animate/0.7.0/auto-animate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>

    <!-- CONFIG -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        oled: '#000000', surface: '#050505', surface2: '#0f0f11', border: '#1f1f22',
                        primary: '#2563eb', accent: '#7c3aed', success: '#059669', danger: '#dc2626', warning: '#d97706', gold: '#fbbf24',
                        textMain: '#ededed', textMuted: '#737373',
                    },
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], mono: ['"Share Tech Mono"', 'monospace'] },
                    boxShadow: { 'glow': '0 0 25px -5px rgba(37, 99, 235, 0.2)' },
                    animation: {
                        'fade-in': 'fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'slide-up': 'slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'scan': 'scan 1.5s ease-in-out infinite',
                        'shake': 'shake 0.4s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        scan: { '0%, 100%': { opacity: '0.2', transform: 'scale(1)' }, '50%': { opacity: '1', transform: 'scale(1.1)' } },
                        shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #000000; color: #ededed; -webkit-font-smoothing: antialiased; overflow-x: hidden; -webkit-tap-highlight-color: transparent; user-select: none; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
        
        .glass-solid { background: rgba(15, 15, 17, 0.85); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        input, select { color-scheme: dark; transition: all 0.2s; }
        input:focus, select:focus { box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.5); border-color: #2563eb; }
        
        #sidebar { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), width 0.3s; }
        #main-wrapper { transition: padding-left 0.3s; }
        .sidebar-text { transition: opacity 0.2s; white-space: nowrap; overflow: hidden; }
        .collapsed .sidebar-text { opacity: 0; width: 0; pointer-events: none; }
        
        #startup-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s, visibility 0.5s; }
        #lock-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 9998; backdrop-filter: blur(20px); }
        .loader-bar { width: 0%; height: 2px; background: #2563eb; transition: width 0.5s ease-out; }
        
        .toast { animation: slideInRight 0.3s forwards; }
        .toast.hiding { animation: fadeOut 0.3s forwards; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(-10px); } }

        /* ATM Card */
        .atm-card { width: 100%; aspect-ratio: 1.586; border-radius: 1.2rem; position: relative; overflow: hidden; color: white; box-shadow: 0 15px 35px -5px rgba(0,0,0,0.6); transition: transform 0.3s; transform-style: preserve-3d; background-size: cover; }
        .atm-card::before { content: ''; position: absolute; inset: 0; background: linear-gradient(115deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 30%, transparent 100%); z-index: 2; pointer-events: none; }
        .card-chip { width: 45px; height: 35px; background: linear-gradient(135deg, #e2c878 0%, #fbf5b7 50%, #e2c878 100%); border-radius: 6px; box-shadow: inset 0 0 2px rgba(0,0,0,0.5); }
        .card-number { font-family: 'Share Tech Mono', monospace; letter-spacing: 2px; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); }
        
        .theme-bca { background: linear-gradient(135deg, #00449e 0%, #002b64 100%); }
        .theme-mandiri { background: linear-gradient(135deg, #002d4a 0%, #006a9e 100%); }
        .theme-bri { background: linear-gradient(135deg, #004b8f 0%, #007ac3 100%); }
        .theme-bni { background: linear-gradient(135deg, #e85d04 0%, #f48c06 100%); }
        .theme-jago { background: linear-gradient(135deg, #7b2cbf 0%, #f72585 100%); }
        .theme-jenius { background: linear-gradient(135deg, #ff9f1c 0%, #ffbf69 100%); }
        .theme-default { background: linear-gradient(135deg, #212529 0%, #343a40 100%); }

        .fingerprint-container { position: relative; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s; cursor: pointer; }
        .fingerprint-container:active { transform: scale(0.95); }
        .fingerprint-progress { position: absolute; inset: 0; border-radius: 50%; border: 2px solid #2563eb; clip-path: circle(0% at 50% 50%); transition: clip-path 0.1s; }
        .fingerprint-container.scanning .fingerprint-progress { transition: clip-path 1.5s ease-out; clip-path: circle(100% at 50% 50%); }
        .pin-dot { width: 12px; height: 12px; border-radius: 50%; background: #27272a; transition: all 0.3s; }
        .pin-dot.filled { background: #3b82f6; box-shadow: 0 0 10px #3b82f6; transform: scale(1.2); }
        .keypad-btn { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: 600; background: rgba(255,255,255,0.05); transition: all 0.1s; cursor: pointer; }
        .keypad-btn:active { background: rgba(37, 99, 235, 0.3); transform: scale(0.95); }

        .bg-ambient { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1; background: radial-gradient(circle at 15% 50%, rgba(37, 99, 235, 0.05), transparent 25%), radial-gradient(circle at 85% 30%, rgba(124, 58, 237, 0.05), transparent 25%); }
        @media (max-width: 1024px) { #sidebar { width: 100% !important; max-width: 300px; } .collapsed { width: 100% !important; } }
        @media (max-width: 640px) { #modal-profile .bg-surface2 { position: absolute; bottom: 0; border-radius: 2rem 2rem 0 0; width: 100%; max-width: 100%; margin: 0; animation: slideUp 0.3s ease-out forwards; } }
    </style>
</head>
<body class="overflow-x-hidden antialiased selection:bg-primary/30 selection:text-white">

    <div id="startup-screen"><div class="text-center"><div class="mb-4 inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-accent shadow-glow animate-bounce"><i class="fa-solid fa-coins text-3xl text-white"></i></div><h1 class="text-3xl font-bold text-white mb-6 tracking-tight">DYERZ<span class="text-primary">.LTD</span></h1><div class="w-48 h-1 bg-surface2 rounded-full overflow-hidden mb-2"><div id="loader-progress" class="loader-bar"></div></div><p id="startup-text" class="text-[10px] text-textMuted font-mono uppercase tracking-widest">System Boot...</p></div></div>
    <div class="bg-ambient"></div>
    <div id="toast-container" class="fixed top-4 right-4 space-y-3 pointer-events-none z-[10000]"></div>
    
    <!-- LOCK SCREEN -->
    <div id="lock-screen" class="hidden flex flex-col items-center justify-center transition-opacity duration-300"><div class="w-full max-w-sm px-8 flex flex-col items-center animate-slide-up"><div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-accent flex items-center justify-center mb-6 shadow-glow animate-float"><i id="lock-icon" class="fa-solid fa-shield-halved text-white text-2xl"></i></div><h2 class="text-2xl font-bold text-white mb-2" id="lock-title">DYERZ Security</h2><p class="text-textMuted text-sm mb-8 text-center" id="lock-msg">Identitas Terproteksi. Masukkan PIN.</p><div class="flex gap-4 mb-10" id="pin-display"><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div></div><div class="grid grid-cols-3 gap-6 mb-8 w-full max-w-[280px]"><button class="keypad-btn" onclick="security.typePin(1)">1</button><button class="keypad-btn" onclick="security.typePin(2)">2</button><button class="keypad-btn" onclick="security.typePin(3)">3</button><button class="keypad-btn" onclick="security.typePin(4)">4</button><button class="keypad-btn" onclick="security.typePin(5)">5</button><button class="keypad-btn" onclick="security.typePin(6)">6</button><button class="keypad-btn" onclick="security.typePin(7)">7</button><button class="keypad-btn" onclick="security.typePin(8)">8</button><button class="keypad-btn" onclick="security.typePin(9)">9</button><div class="flex items-center justify-center"><div id="fingerprint-btn" class="fingerprint-container" onmousedown="security.startScan()" ontouchstart="security.startScan()" onmouseup="security.endScan()" ontouchend="security.endScan()"><div class="fingerprint-progress"></div><i class="fa-solid fa-fingerprint text-2xl text-textMuted transition-colors"></i></div></div><button class="keypad-btn" onclick="security.typePin(0)">0</button><button class="h-16 w-16 rounded-full flex items-center justify-center text-danger hover:bg-danger/10 transition-all active:scale-95" onclick="security.delPin()"><i class="fa-solid fa-delete-left text-xl"></i></button></div><button id="btn-cancel-lock" onclick="security.cancelVerify()" class="text-xs text-textMuted hover:text-white transition-colors hidden">Batalkan</button><button id="btn-forgot-pin" onclick="security.forgotPin()" class="text-xs text-textMuted hover:text-white transition-colors">Lupa PIN?</button></div></div>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 bg-surface/95 backdrop-blur-xl lg:bg-surface border-r border-border transform -translate-x-full lg:translate-x-0 flex flex-col h-full shadow-2xl lg:shadow-none overflow-hidden group/sidebar select-none transition-transform duration-300">
        <div class="h-24 flex items-center justify-between px-6 border-b border-border/50 shrink-0"><div class="flex items-center"><div class="logo-icon w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center mr-4 shadow-glow shrink-0"><i class="fa-solid fa-coins text-white text-lg"></i></div><div class="logo-text overflow-hidden"><h1 class="text-xl font-bold tracking-tight text-white leading-tight">DYERZ<span class="text-primary">.LTD</span></h1><p class="text-[10px] text-textMuted tracking-widest uppercase">Finance OS 2.0</p></div></div><button onclick="ui.toggleMobileSidebar()" class="lg:hidden text-textMuted hover:text-white p-2 rounded-lg hover:bg-white/5 transition-all"><i class="fa-solid fa-xmark text-xl"></i></button></div>
        <div class="flex-1 overflow-y-auto py-6 px-3 space-y-1 scrollbar-hide">
            <button onclick="router.navigate('dashboard')" class="nav-item w-full flex items-center gap-3 px-3 py-3.5 rounded-xl text-sm font-medium transition-all text-textMuted hover:bg-white/5 hover:text-white group relative" data-page="dashboard"><div class="w-6 h-6 flex items-center justify-center shrink-0 relative"><i class="fa-solid fa-border-all text-lg group-hover:text-primary transition-colors z-10"></i><div class="absolute inset-0 bg-primary/30 rounded-full blur-md opacity-0 group-hover:opacity-100 transition-opacity"></div></div><span class="sidebar-text">Dashboard</span></button>
            <button onclick="router.navigate('wallet')" class="nav-item w-full flex items-center gap-3 px-3 py-3.5 rounded-xl text-sm font-medium transition-all text-textMuted hover:bg-white/5 hover:text-white group" data-page="wallet"><div class="w-6 h-6 flex items-center justify-center shrink-0"><i class="fa-solid fa-wallet text-lg group-hover:text-gold transition-colors"></i></div><span class="sidebar-text">Wallet & ATM</span></button>
            <button onclick="router.navigate('transactions')" class="nav-item w-full flex items-center gap-3 px-3 py-3.5 rounded-xl text-sm font-medium transition-all text-textMuted hover:bg-white/5 hover:text-white group" data-page="transactions"><div class="w-6 h-6 flex items-center justify-center shrink-0"><i class="fa-solid fa-arrow-right-arrow-left text-lg group-hover:text-success transition-colors"></i></div><span class="sidebar-text">Transaksi</span></button>
            <button onclick="router.navigate('goals')" class="nav-item w-full flex items-center gap-3 px-3 py-3.5 rounded-xl text-sm font-medium transition-all text-textMuted hover:bg-white/5 hover:text-white group" data-page="goals"><div class="w-6 h-6 flex items-center justify-center shrink-0"><i class="fa-solid fa-bullseye text-lg group-hover:text-accent transition-colors"></i></div><span class="sidebar-text">Target & Impian</span></button>
            <div class="my-6 h-px bg-border/50 mx-4"></div>
            <button onclick="router.navigate('budget')" class="nav-item w-full flex items-center gap-3 px-3 py-3.5 rounded-xl text-sm font-medium transition-all text-textMuted hover:bg-white/5 hover:text-white group" data-page="budget"><div class="w-6 h-6 flex items-center justify-center shrink-0"><i class="fa-solid fa-chart-pie text-lg group-hover:text-warning transition-colors"></i></div><span class="sidebar-text">Budget Control</span></button>
            <button onclick="router.navigate('settings')" class="nav-item w-full flex items-center gap-3 px-3 py-3.5 rounded-xl text-sm font-medium transition-all text-textMuted hover:bg-white/5 hover:text-white group" data-page="settings"><div class="w-6 h-6 flex items-center justify-center shrink-0"><i class="fa-solid fa-sliders text-lg group-hover:text-primary transition-colors"></i></div><span class="sidebar-text">Pengaturan</span></button>
            <button onclick="security.lockApp()" class="w-full flex items-center gap-3 px-3 py-3.5 rounded-xl text-sm font-medium transition-all text-textMuted hover:bg-white/5 hover:text-white group mt-auto"><div class="w-6 h-6 flex items-center justify-center shrink-0"><i class="fa-solid fa-lock text-lg group-hover:text-white transition-colors"></i></div><span class="sidebar-text">Kunci Sesi</span></button>
        </div>
        <div class="p-4 border-t border-border/50 bg-surface/50 lg:bg-surface shrink-0"><button id="pin-sidebar-btn" onclick="ui.toggleSidebarPin()" class="hidden lg:flex w-full items-center gap-3 px-3 py-2.5 rounded-lg text-xs font-medium text-textMuted hover:text-white hover:bg-white/5 mb-3 transition-all"><div class="w-6 h-6 flex items-center justify-center shrink-0"><i id="pin-icon" class="fa-solid fa-thumbtack -rotate-45 transition-transform duration-300"></i></div><span class="sidebar-text" id="pin-text">Pin Menu</span></button><button onclick="ui.openModal('modal-profile')" class="w-full flex items-center gap-3 p-2.5 rounded-xl bg-surface2 border border-border hover:border-primary/50 transition-all group text-left relative overflow-hidden"><div id="sidebar-avatar-bg" class="w-9 h-9 rounded-lg bg-gradient-to-tr from-primary to-accent flex items-center justify-center relative z-10 font-bold text-white shadow-lg shrink-0 text-sm"><span id="sidebar-avatar-text">D</span></div><div class="flex-1 min-w-0 relative z-10 sidebar-text"><p id="sidebar-name" class="text-sm font-bold text-white truncate group-hover:text-primary transition-colors">Dyerz User</p><p id="sidebar-level" class="text-[10px] text-textMuted truncate uppercase tracking-wider">Pro Account</p></div></button></div>
    </aside>

    <div id="mobile-overlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 hidden lg:hidden transition-opacity duration-300" onclick="ui.toggleMobileSidebar()"></div>

    <div id="main-wrapper" class="lg:pl-72 flex flex-col min-h-screen transition-all duration-300">
        <header class="sticky top-0 z-30 h-20 bg-surface/80 backdrop-blur-md border-b border-border/50 px-4 sm:px-8 flex items-center justify-between"><div class="flex items-center gap-4"><button onclick="ui.toggleMobileSidebar()" class="lg:hidden w-10 h-10 flex items-center justify-center rounded-xl bg-surface2 border border-border text-textMuted hover:text-white"><i class="fa-solid fa-bars-staggered"></i></button><div><h2 id="page-title" class="text-lg font-bold text-white leading-none">Overview</h2><div class="flex items-center gap-2 mt-1"><span class="w-1.5 h-1.5 rounded-full bg-success animate-pulse"></span><p class="text-xs text-textMuted" id="current-date">...</p></div></div></div><div class="flex items-center gap-4"><div class="hidden md:flex items-center px-4 py-2.5 bg-surface2 border border-border rounded-full w-64 focus-within:border-primary focus-within:ring-1 focus-within:ring-primary/50 transition-all group"><i class="fa-solid fa-magnifying-glass text-textMuted text-xs mr-3 group-focus-within:text-primary transition-colors"></i><input type="text" id="global-search" onkeyup="handlers.search(this.value)" placeholder="Cari data..." class="bg-transparent border-none outline-none text-sm text-white w-full placeholder-textMuted/50"><div id="search-results" class="absolute top-14 left-0 w-full bg-surface2 border border-border rounded-xl shadow-2xl p-2 hidden z-50"></div></div><div class="relative"><button onclick="ui.toggleNotifications()" class="w-10 h-10 rounded-full bg-surface2 border border-border flex items-center justify-center text-textMuted hover:text-white hover:border-warning/50 transition-all relative"><i class="fa-regular fa-bell"></i><span id="notif-dot" class="absolute top-2.5 right-3 w-2 h-2 bg-danger rounded-full hidden border border-black"></span></button><div id="notification-panel" class="absolute right-0 top-12 w-80 bg-surface2 border border-border rounded-2xl shadow-2xl p-4 hidden transform transition-all z-50 origin-top-right scale-95 opacity-0 backdrop-blur-xl"><div class="flex justify-between items-center mb-3 pb-2 border-b border-white/5"><h4 class="text-sm font-bold text-white">Notifikasi</h4><button onclick="ui.clearNotifications()" class="text-[10px] text-primary hover:text-white transition-colors">Hapus Semua</button></div><div id="notification-list" class="space-y-2 max-h-64 overflow-y-auto pr-1 scrollbar-hide"><p class="text-center text-xs text-textMuted py-4">Tidak ada notifikasi baru</p></div></div></div></div></header>

        <main class="flex-1 p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto w-full transition-all">
            <!-- DASHBOARD -->
            <div id="view-dashboard" class="page-view space-y-8 animate-slide-up"><div id="welcome-banner" class="hidden relative overflow-hidden rounded-3xl bg-gradient-to-r from-primary/10 to-accent/10 border border-white/5 p-8 group"><div class="relative z-10 max-w-2xl"><h2 class="text-3xl font-bold text-white mb-2">Halo, <span id="banner-name" class="text-primary">Dyerz</span>! ðŸ‘‹</h2><p class="text-textMuted mb-6 text-sm leading-relaxed">Selamat datang di DYERZ.LTD. Keuangan Anda belum tercatat.</p><button onclick="ui.openModal('modal-add-transaction')" class="px-6 py-3 bg-white text-black font-bold rounded-xl hover:scale-105 transition-transform shadow-lg flex items-center gap-2"><i class="fa-solid fa-plus"></i> Catat Transaksi</button></div><div class="absolute top-0 right-0 w-64 h-64 bg-primary/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:bg-primary/30 transition-colors duration-500"></div></div><div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6"><div class="glass-solid p-6 rounded-3xl hover-card group cursor-default"><div class="flex justify-between items-start mb-8 relative z-10"><div class="w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center text-primary border border-primary/20 group-hover:scale-110 transition-transform duration-300"><i class="fa-solid fa-wallet text-xl"></i></div><span class="px-2.5 py-1 rounded-full bg-surface border border-border text-[10px] font-mono text-textMuted">NET WORTH</span></div><div class="relative z-10"><div class="flex items-center gap-2 mb-1"><p class="text-textMuted text-xs font-medium uppercase tracking-wider">Total Kekayaan</p><button onclick="ui.togglePrivacy()" class="text-textMuted hover:text-white transition-colors focus:outline-none" title="Sembunyikan/Tampilkan Saldo"><i id="privacy-icon" class="fa-solid fa-eye"></i></button></div><h3 class="text-3xl sm:text-4xl font-bold text-white tracking-tight leading-none" id="dash-balance">Rp 0</h3></div><div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-transparent opacity-50 group-hover:opacity-100 transition-opacity"></div></div><div class="glass-solid p-6 rounded-3xl hover-card group cursor-default"><div class="flex justify-between items-start mb-8 relative z-10"><div class="w-12 h-12 rounded-2xl bg-success/10 flex items-center justify-center text-success border border-success/20 group-hover:scale-110 transition-transform duration-300"><i class="fa-solid fa-arrow-trend-up text-xl"></i></div><span class="px-2.5 py-1 rounded-full bg-surface border border-border text-[10px] font-mono text-textMuted">MONTHLY</span></div><div class="relative z-10"><p class="text-textMuted text-xs font-medium uppercase tracking-wider mb-1">Pemasukan</p><h3 class="text-2xl sm:text-3xl font-bold text-white tracking-tight leading-none" id="dash-income">Rp 0</h3></div><div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-success to-transparent opacity-50 group-hover:opacity-100 transition-opacity"></div></div><div class="glass-solid p-6 rounded-3xl hover-card group cursor-default"><div class="flex justify-between items-start mb-8 relative z-10"><div class="w-12 h-12 rounded-2xl bg-danger/10 flex items-center justify-center text-danger border border-danger/20 group-hover:scale-110 transition-transform duration-300"><i class="fa-solid fa-arrow-trend-down text-xl"></i></div><span class="px-2.5 py-1 rounded-full bg-surface border border-border text-[10px] font-mono text-textMuted">MONTHLY</span></div><div class="relative z-10"><p class="text-textMuted text-xs font-medium uppercase tracking-wider mb-1">Pengeluaran</p><h3 class="text-2xl sm:text-3xl font-bold text-white tracking-tight leading-none" id="dash-expense">Rp 0</h3></div><div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-danger to-transparent opacity-50 group-hover:opacity-100 transition-opacity"></div></div></div><div class="grid grid-cols-1 xl:grid-cols-3 gap-6 sm:gap-8"><div class="xl:col-span-2 glass-solid rounded-3xl p-6 sm:p-8 border border-border/50"><div class="flex justify-between items-center mb-8"><div><h3 class="font-bold text-xl text-white">Analisis Arus Kas</h3><p class="text-xs text-textMuted mt-1">Ringkasan 7 hari terakhir</p></div><div class="flex gap-2"><span class="w-2 h-2 rounded-full bg-primary animate-pulse"></span><span class="text-[10px] text-primary font-mono">LIVE UPDATE</span></div></div><div class="h-[300px] w-full relative"><canvas id="mainChart"></canvas></div></div><div class="glass-solid rounded-3xl p-6 border border-border/50 flex flex-col h-[450px] xl:h-auto"><div class="flex justify-between items-center mb-6"><h3 class="font-bold text-xl text-white">Riwayat</h3><button onclick="router.navigate('transactions')" class="text-xs text-primary hover:text-white transition-colors">Lihat Semua</button></div><div id="dash-recent-list" class="flex-1 overflow-y-auto space-y-3 pr-2 scrollbar-thin"></div></div></div></div>
            
            <!-- WALLET -->
            <div id="view-wallet" class="page-view hidden space-y-8 animate-slide-up"><div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"><div><h3 class="text-2xl font-bold text-white">Dompet Digital</h3><p class="text-textMuted text-xs mt-1">Kelola kartu dan aset digital Anda.</p></div><button onclick="ui.openModal('modal-add-card')" class="px-5 py-2.5 bg-gold hover:bg-yellow-600 text-black rounded-xl text-sm font-bold shadow-lg transition-all active:scale-95 flex items-center gap-2"><i class="fa-solid fa-plus"></i> Tambah Kartu</button></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="space-y-6" id="wallet-cards-container"></div><div class="glass-solid p-6 rounded-3xl border border-border/50"><h4 class="font-bold text-white mb-4">Statistik Dompet</h4><div class="grid grid-cols-2 gap-4 mb-6"><div class="p-4 rounded-2xl bg-surface2 border border-border"><p class="text-[10px] text-textMuted uppercase font-bold">Total Kartu</p><p class="text-2xl font-bold text-white mt-1" id="wallet-total-cards">0</p></div><div class="p-4 rounded-2xl bg-surface2 border border-border"><p class="text-[10px] text-textMuted uppercase font-bold">Total Saldo Kartu</p><p class="text-xl font-bold text-gold mt-1 truncate" id="wallet-total-balance">Rp 0</p></div></div><div class="p-4 rounded-2xl bg-primary/10 border border-primary/20 flex gap-4 items-center"><div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary"><i class="fa-solid fa-circle-info"></i></div><p class="text-xs text-textMuted leading-relaxed">Saldo pada kartu dihitung sebagai bagian dari Total Kekayaan (Net Worth) Anda di dashboard utama.</p></div></div></div></div>
            
            <!-- TRANSACTIONS -->
            <div id="view-transactions" class="page-view hidden space-y-6 animate-slide-up"><div class="flex flex-col sm:flex-row justify-between items-center gap-4"><div class="flex gap-2 overflow-x-auto w-full sm:w-auto p-1 bg-surface2 rounded-xl border border-border"><button onclick="filters.set('all')" class="filter-btn active px-4 py-2 rounded-lg text-xs font-bold transition-all">Semua</button><button onclick="filters.set('income')" class="filter-btn px-4 py-2 rounded-lg text-xs font-bold transition-all hover:text-success">Masuk</button><button onclick="filters.set('expense')" class="filter-btn px-4 py-2 rounded-lg text-xs font-bold transition-all hover:text-danger">Keluar</button></div><button onclick="ui.openModal('modal-add-transaction')" class="w-full sm:w-auto px-6 py-2.5 bg-primary hover:bg-blue-600 text-white rounded-xl text-sm font-bold shadow-glow transition-all active:scale-95"><i class="fa-solid fa-plus mr-2"></i> Transaksi Baru</button></div><div class="hidden md:block glass-solid rounded-3xl overflow-hidden border border-border/50"><div class="overflow-x-auto"><table class="w-full text-left"><thead class="bg-surface2/50 border-b border-border/50"><tr><th class="px-6 py-4 text-xs font-bold text-textMuted uppercase">Tanggal</th><th class="px-6 py-4 text-xs font-bold text-textMuted uppercase">Kategori</th><th class="px-6 py-4 text-xs font-bold text-textMuted uppercase">Keterangan</th><th class="px-6 py-4 text-xs font-bold text-textMuted uppercase text-right">Jumlah</th><th class="px-6 py-4 text-center text-xs font-bold text-textMuted uppercase">Aksi</th></tr></thead><tbody id="transaction-table-body" class="divide-y divide-border/30 text-sm"></tbody></table></div></div><div id="transaction-mobile-list" class="md:hidden space-y-3"></div><div id="empty-state-transactions" class="hidden flex flex-col items-center justify-center py-20 text-center text-textMuted"><div class="w-16 h-16 rounded-full bg-surface border border-border flex items-center justify-center mb-4 text-2xl opacity-50"><i class="fa-solid fa-file-invoice"></i></div><p class="text-sm">Belum ada data transaksi.</p></div></div>
            
            <!-- GOALS -->
            <div id="view-goals" class="page-view hidden space-y-6 animate-slide-up"><div class="flex justify-between items-center"><div><h3 class="text-2xl font-bold text-white">Target Impian</h3><p class="text-textMuted text-xs">Visualisasikan dan wujudkan mimpimu.</p></div><button onclick="ui.openModal('modal-add-goal')" class="px-5 py-2.5 bg-accent hover:bg-purple-600 text-white rounded-xl text-sm font-bold shadow-glow-accent transition-all active:scale-95"><i class="fa-solid fa-plus mr-2"></i> Buat Target</button></div><div id="goals-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div><div id="empty-state-goals" class="hidden flex flex-col items-center justify-center py-20 border border-dashed border-border rounded-3xl bg-surface/20"><div class="w-16 h-16 rounded-full bg-surface border border-border flex items-center justify-center mb-4 text-2xl opacity-50"><i class="fa-solid fa-bullseye"></i></div><h3 class="text-lg font-bold text-white mb-1">Belum Ada Target</h3><p class="text-xs text-textMuted mb-4">Mulai menabung untuk sesuatu yang spesial.</p><button onclick="ui.openModal('modal-add-goal')" class="text-primary hover:text-white text-sm font-medium transition-colors">Buat Sekarang &rarr;</button></div></div>
            
            <!-- BUDGET -->
            <div id="view-budget" class="page-view hidden space-y-6 animate-slide-up"><div class="max-w-2xl mx-auto glass-solid p-8 rounded-3xl border border-border/50"><h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><div class="p-2 rounded-lg bg-warning/10 text-warning"><i class="fa-solid fa-shield-halved"></i></div>Batas Belanja Bulanan</h3><div class="space-y-8"><div class="relative group"><label class="block text-xs font-bold text-textMuted uppercase mb-2 ml-1">Batas Pengeluaran (Rp)</label><input type="text" inputmode="decimal" id="budget-limit-input" placeholder="0 = Unlimited" class="currency-input w-full bg-surface2 border border-border rounded-xl px-5 py-4 text-white focus:border-warning focus:ring-1 focus:ring-warning/50 focus:outline-none text-xl font-bold tracking-wide transition-all"><div class="absolute right-4 top-[38px] text-textMuted text-sm">IDR</div></div><div class="bg-surface rounded-2xl p-6 border border-border/50 relative overflow-hidden"><div class="flex justify-between text-sm mb-2 relative z-10"><span class="text-textMuted">Terpakai Bulan Ini</span><span class="text-white font-bold font-mono" id="budget-spent-display">Rp 0</span></div><div class="flex justify-between text-sm mb-4 relative z-10"><span class="text-textMuted">Batas Maksimal</span><span class="text-white font-bold font-mono" id="budget-limit-display">Unlimited</span></div><div class="w-full h-4 bg-black rounded-full overflow-hidden border border-white/5 relative z-10"><div id="budget-progress" class="h-full bg-warning transition-all duration-1000 ease-out shadow-[0_0_15px_rgba(245,158,11,0.5)]" style="width: 0%"></div></div><div id="budget-warning" class="mt-4 flex items-center gap-2 text-danger text-xs font-bold bg-danger/10 px-3 py-2 rounded-lg border border-danger/20 hidden animate-pulse"><i class="fa-solid fa-triangle-exclamation"></i><span>PERINGATAN: Anda telah melewati batas budget!</span></div></div><button onclick="saveBudget()" class="w-full py-4 bg-warning hover:bg-amber-600 text-black font-bold rounded-xl shadow-[0_0_20px_-5px_rgba(245,158,11,0.4)] transition-all active:scale-95">Simpan Pengaturan</button></div></div></div>
            
            <!-- SETTINGS -->
            <div id="view-settings" class="page-view hidden space-y-6 animate-slide-up"><div class="max-w-2xl mx-auto glass-solid p-8 rounded-3xl border border-border/50"><h3 class="text-2xl font-bold mb-8 flex items-center gap-3"><div class="p-2 rounded-lg bg-primary/10 text-primary"><i class="fa-solid fa-lock"></i></div>Pusat Keamanan & Data</h3><div class="space-y-4"><div class="p-5 rounded-2xl bg-surface2 border border-border/50 flex justify-between items-center transition-colors hover:border-primary/30"><div><p class="font-bold text-white text-sm">Proteksi PIN Aplikasi</p><p id="setting-pin-status" class="text-xs text-textMuted mt-1">Amankan data Anda dari akses tidak sah</p></div><button id="btn-toggle-pin" onclick="security.togglePinFlow()" class="px-5 py-2.5 rounded-xl bg-surface border border-border text-xs font-bold text-white hover:bg-white/5 transition-all">Atur PIN</button></div><div class="p-5 rounded-2xl bg-surface2 border border-border/50 flex justify-between items-center opacity-50 transition-all hover:border-primary/30" id="bio-settings-card"><div><p class="font-bold text-white text-sm flex items-center gap-2">Login Sidik Jari <i class="fa-solid fa-fingerprint text-accent"></i></p><p class="text-xs text-textMuted mt-1">Akses cepat tanpa mengetik PIN</p></div><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="toggle-bio" class="sr-only peer" onchange="security.toggleBiometric(this)"><div class="w-12 h-7 bg-surface border border-border peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[4px] after:left-[4px] after:bg-textMuted after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent peer-checked:after:bg-white peer-checked:border-accent"></div></label></div><div class="grid grid-cols-2 gap-4 mt-4"><div class="p-5 rounded-2xl bg-surface2 border border-border hover:bg-white/5 hover:border-white/10 text-left group transition-all cursor-pointer" onclick="document.getElementById('csv-upload').click()"><div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary mb-3 group-hover:scale-110 transition-transform"><i class="fa-solid fa-file-import text-xl"></i></div><span class="font-bold text-sm block text-white">Import Data</span><span class="text-[10px] text-textMuted block mt-1">Pulihkan Backup CSV</span><input type="file" id="csv-upload" class="hidden" accept=".csv" onchange="handlers.importCSV(this)"></div><button onclick="exportDataToCSV()" class="p-5 rounded-2xl bg-surface2 border border-border hover:bg-white/5 hover:border-white/10 text-left group transition-all"><div class="w-10 h-10 rounded-lg bg-success/10 flex items-center justify-center text-success mb-3 group-hover:scale-110 transition-transform"><i class="fa-solid fa-file-csv text-xl"></i></div><span class="font-bold text-sm block text-white">Export Data</span><span class="text-[10px] text-textMuted block mt-1">Backup Lengkap CSV</span></button><button onclick="hardReset()" class="p-5 rounded-2xl bg-surface2 border border-border hover:bg-danger/5 hover:border-danger/30 text-left group transition-all col-span-2"><div class="w-10 h-10 rounded-lg bg-danger/10 flex items-center justify-center text-danger mb-3 group-hover:scale-110 transition-transform"><i class="fa-solid fa-triangle-exclamation text-xl"></i></div><span class="font-bold text-sm block text-white group-hover:text-danger transition-colors">Reset Aplikasi</span><span class="text-[10px] text-textMuted block mt-1">Hapus permanen</span></button></div></div></div></div>
        </main>
    </div>

    <!-- MODALS (Card, Transaction, Goal, Profile, Add Fund) -->
    <div id="modal-add-card" class="modal fixed inset-0 z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-all duration-300"><div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="ui.closeModal('modal-add-card')"></div><div class="bg-surface2 border border-border w-full max-w-md p-8 rounded-3xl relative transform scale-95 transition-all duration-300 shadow-2xl mx-4"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-white">Tambah Kartu</h3><button onclick="ui.closeModal('modal-add-card')" class="text-textMuted hover:text-white transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button></div><form onsubmit="handlers.submitCard(event)" class="space-y-5"><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Bank Penerbit</label><select name="bank" class="w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-primary focus:outline-none text-sm"><option value="bca">BCA</option><option value="mandiri">Mandiri</option><option value="bri">BRI</option><option value="bni">BNI</option><option value="jago">Jago</option><option value="jenius">Jenius</option><option value="default">Lainnya</option></select></div><div class="grid grid-cols-2 gap-4"><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Nomor Rekening</label><input type="text" inputmode="decimal" name="number" required placeholder="1234567890" class="w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-primary focus:outline-none text-sm"></div><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Valid Thru</label><input type="text" name="valid" required placeholder="MM/YY" maxlength="5" class="valid-thru-input w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-primary focus:outline-none text-sm text-center tracking-widest"></div></div><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Nomor Kartu (16 Digit)</label><input type="text" inputmode="decimal" name="cardnum" required placeholder="0000 0000 0000 0000" class="card-num-input w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-primary focus:outline-none text-sm font-mono tracking-widest"></div><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Pemegang Kartu</label><input type="text" name="holder" required placeholder="Nama di Kartu" class="w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-primary focus:outline-none text-sm uppercase"></div><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Saldo Awal</label><input type="text" inputmode="decimal" name="balance" required placeholder="0" class="currency-input w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-primary focus:outline-none text-sm font-bold"></div><button type="submit" class="w-full py-4 bg-gold hover:bg-yellow-600 text-black rounded-xl font-bold shadow-lg mt-4 transition-all active:scale-95">Simpan Kartu</button></form></div></div>
    <div id="modal-add-transaction" class="modal fixed inset-0 z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-all duration-300"><div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="ui.closeModal('modal-add-transaction')"></div><div class="bg-surface2 border border-border w-full max-w-md p-8 rounded-3xl relative transform scale-95 transition-all duration-300 shadow-2xl mx-4"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-white">Catat Transaksi</h3><button onclick="ui.closeModal('modal-add-transaction')" class="text-textMuted hover:text-white transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button></div><form onsubmit="handlers.submitTransaction(event)" class="space-y-5"><div class="grid grid-cols-2 gap-2 p-1.5 bg-black rounded-xl border border-border"><label class="cursor-pointer relative z-10"><input type="radio" name="type" value="income" class="peer sr-only" onchange="ui.updateCategoryOptions('income')"><div class="text-center py-3 rounded-lg text-xs font-bold text-textMuted peer-checked:text-black peer-checked:bg-success transition-all"><i class="fa-solid fa-arrow-down mr-1"></i> Pemasukan</div></label><label class="cursor-pointer relative z-10"><input type="radio" name="type" value="expense" class="peer sr-only" checked onchange="ui.updateCategoryOptions('expense')"><div class="text-center py-3 rounded-lg text-xs font-bold text-textMuted peer-checked:text-white peer-checked:bg-danger transition-all"><i class="fa-solid fa-arrow-up mr-1"></i> Pengeluaran</div></label></div><div class="relative group"><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Nominal</label><div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-textMuted font-bold group-focus-within:text-white transition-colors">Rp</span><input type="text" inputmode="decimal" name="amount" required placeholder="0" class="currency-input w-full bg-surface border border-border rounded-xl pl-12 pr-4 py-4 text-white focus:border-primary focus:ring-1 focus:ring-primary/50 focus:outline-none text-xl font-bold tracking-wide transition-all"></div></div><div class="grid grid-cols-2 gap-4"><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Keterangan</label><input type="text" name="desc" required placeholder="Contoh: Gaji" class="w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-primary focus:outline-none text-sm"></div><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Tanggal</label><input type="date" name="date" class="w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-primary focus:outline-none text-sm"></div></div><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Kategori</label><select id="trx-category-select" name="category" class="w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-primary focus:outline-none appearance-none cursor-pointer text-sm"></select></div><button type="submit" class="w-full py-4 bg-primary hover:bg-blue-600 text-white rounded-xl font-bold shadow-glow mt-4 transition-all active:scale-95">Simpan Data</button></form></div></div>
    <div id="modal-add-goal" class="modal fixed inset-0 z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-all duration-300"><div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="ui.closeModal('modal-add-goal')"></div><div class="bg-surface2 border border-border w-full max-w-md p-8 rounded-3xl relative transform scale-95 transition-all duration-300 shadow-2xl mx-4"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-white">Target Impian Baru</h3><button onclick="ui.closeModal('modal-add-goal')" class="text-textMuted hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button></div><form onsubmit="handlers.submitGoal(event)" class="space-y-5"><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Nama Target</label><input type="text" name="name" required placeholder="Contoh: MacBook M3" class="w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-accent focus:outline-none text-sm"></div><div class="grid grid-cols-2 gap-4"><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Target Dana</label><input type="text" inputmode="decimal" name="target" required placeholder="0" class="currency-input w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-accent focus:outline-none text-sm font-bold"></div><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Dana Awal</label><input type="text" inputmode="decimal" name="current" placeholder="0" class="currency-input w-full bg-surface border border-border rounded-xl px-4 py-3 text-white focus:border-accent focus:outline-none text-sm font-bold"></div></div><div><label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-2 block">Pilih Warna Indikator</label><div class="flex gap-4 justify-center p-3 bg-surface rounded-xl border border-border"><label class="cursor-pointer group"><input type="radio" name="color" value="primary" class="peer sr-only" checked><div class="w-8 h-8 rounded-full bg-primary border-2 border-transparent peer-checked:border-white peer-checked:scale-110 transition-all shadow-glow"></div></label><label class="cursor-pointer group"><input type="radio" name="color" value="accent" class="peer sr-only"><div class="w-8 h-8 rounded-full bg-accent border-2 border-transparent peer-checked:border-white peer-checked:scale-110 transition-all shadow-glow-accent"></div></label><label class="cursor-pointer group"><input type="radio" name="color" value="success" class="peer sr-only"><div class="w-8 h-8 rounded-full bg-success border-2 border-transparent peer-checked:border-white peer-checked:scale-110 transition-all"></div></label><label class="cursor-pointer group"><input type="radio" name="color" value="warning" class="peer sr-only"><div class="w-8 h-8 rounded-full bg-warning border-2 border-transparent peer-checked:border-white peer-checked:scale-110 transition-all"></div></label></div></div><button type="submit" class="w-full py-4 bg-accent hover:bg-purple-600 text-white rounded-xl font-bold shadow-glow-accent mt-2 transition-all active:scale-95">Buat Target</button></form></div></div>
    <div id="modal-profile" class="modal fixed inset-0 z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-all duration-300"><div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="ui.closeModal('modal-profile')"></div><div class="bg-surface2 border border-border w-full max-w-sm sm:max-w-lg p-6 sm:p-10 rounded-[2rem] relative transform scale-95 transition-all duration-300 shadow-2xl mx-4 flex flex-col sm:flex-row gap-8 overflow-y-auto max-h-[90vh] sm:max-h-none"><div class="flex flex-col items-center justify-center sm:w-1/3 border-b sm:border-b-0 sm:border-r border-border/50 pb-6 sm:pb-0 sm:pr-8 shrink-0"><div class="relative group cursor-pointer mb-4 hover:scale-105 transition-transform duration-300"><div id="preview-avatar" class="w-32 h-32 sm:w-40 sm:h-40 rounded-3xl bg-surface border-2 border-border/50 flex items-center justify-center overflow-hidden shadow-glow transition-all group-hover:border-primary"><span id="preview-initial" class="text-6xl font-bold text-white">?</span><img id="preview-img" src="" class="w-full h-full object-cover hidden"></div><div class="absolute -bottom-2 -right-2 w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white shadow-lg border-4 border-surface2 group-hover:bg-white group-hover:text-primary transition-colors"><i class="fa-solid fa-camera text-sm"></i></div><input type="file" id="input-profile-photo" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer z-10" onchange="handlers.handlePhotoUpload(this)"></div><p class="text-xs text-textMuted text-center font-medium">Ketuk foto untuk ubah</p><div id="profile-preview-badge" class="mt-4 px-3 py-1 rounded-full bg-white/5 text-[10px] font-bold text-white uppercase tracking-widest border border-white/10">Free Plan</div></div><div class="flex-1 space-y-6"><div class="flex justify-between items-center mb-2"><div><h3 class="text-2xl font-bold text-white">Edit Profil</h3><p class="text-xs text-textMuted">Perbarui identitas anda</p></div><button onclick="ui.closeModal('modal-profile')" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-textMuted hover:text-white hover:bg-white/10 transition-all"><i class="fa-solid fa-xmark text-lg"></i></button></div><form onsubmit="handlers.updateProfile(event)" class="space-y-5"><div class="space-y-1"><label class="text-[10px] font-bold text-primary uppercase ml-1 tracking-wider">Nama Lengkap</label><input type="text" id="input-profile-name" required class="w-full bg-black border border-border rounded-xl px-5 py-3.5 text-white focus:border-primary focus:ring-1 focus:ring-primary/50 focus:outline-none transition-all placeholder-white/20" placeholder="Nama Anda"></div><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div class="space-y-1"><label class="text-[10px] font-bold text-textMuted uppercase ml-1 tracking-wider">Email</label><input type="email" id="input-profile-email" placeholder="email@anda.com" class="w-full bg-black border border-border rounded-xl px-5 py-3.5 text-white focus:border-primary focus:outline-none transition-all placeholder-white/20 text-sm"></div><div class="space-y-1"><label class="text-[10px] font-bold text-textMuted uppercase ml-1 tracking-wider">Pekerjaan / Bio</label><input type="text" id="input-profile-bio" placeholder="Investor" class="w-full bg-black border border-border rounded-xl px-5 py-3.5 text-white focus:border-primary focus:outline-none transition-all placeholder-white/20 text-sm"></div></div><div class="space-y-1"><label class="text-[10px] font-bold text-gold uppercase ml-1 tracking-wider">Status Akun</label><div class="relative"><select id="input-profile-level" class="w-full bg-black border border-border rounded-xl px-5 py-3.5 text-white focus:border-gold focus:ring-1 focus:ring-gold/50 focus:outline-none text-sm appearance-none cursor-pointer"><option value="Free Plan">Free Plan (Gratis)</option><option value="Pro Investor ðŸ’¼">Pro Investor ðŸ’¼</option><option value="Sultan Mode ðŸ‘‘">Sultan Mode ðŸ‘‘</option><option value="Student Saver ðŸŽ“">Student Saver ðŸŽ“</option></select><i class="fa-solid fa-crown absolute right-5 top-1/2 -translate-y-1/2 text-xs text-gold pointer-events-none"></i></div></div><div class="space-y-2 pt-2"><label class="text-[10px] font-bold text-textMuted uppercase ml-1 tracking-wider block">Warna Tema</label><div class="grid grid-cols-4 gap-3"><label class="cursor-pointer flex-1"><input type="radio" name="avatarColor" value="blue" class="peer sr-only"><div class="h-12 rounded-xl bg-gradient-to-tr from-blue-600 to-cyan-400 peer-checked:ring-2 ring-white peer-checked:scale-105 transition-all opacity-60 peer-checked:opacity-100 hover:opacity-80"></div></label><label class="cursor-pointer flex-1"><input type="radio" name="avatarColor" value="purple" class="peer sr-only"><div class="h-12 rounded-xl bg-gradient-to-tr from-purple-600 to-pink-400 peer-checked:ring-2 ring-white peer-checked:scale-105 transition-all opacity-60 peer-checked:opacity-100 hover:opacity-80"></div></label><label class="cursor-pointer flex-1"><input type="radio" name="avatarColor" value="green" class="peer sr-only"><div class="h-12 rounded-xl bg-gradient-to-tr from-emerald-600 to-lime-400 peer-checked:ring-2 ring-white peer-checked:scale-105 transition-all opacity-60 peer-checked:opacity-100 hover:opacity-80"></div></label><label class="cursor-pointer flex-1"><input type="radio" name="avatarColor" value="gold" class="peer sr-only"><div class="h-12 rounded-xl bg-gradient-to-tr from-yellow-600 to-orange-400 peer-checked:ring-2 ring-white peer-checked:scale-105 transition-all opacity-60 peer-checked:opacity-100 hover:opacity-80"></div></label></div></div><button type="submit" class="w-full py-4 bg-white text-black rounded-xl font-bold shadow-lg hover:bg-gray-200 transition-all active:scale-95 mt-2 flex items-center justify-center gap-2"><i class="fa-solid fa-check"></i> Simpan Profil</button></form></div></div></div>

    <!-- NEW MODAL: ADD FUND (TABUNG) -->
    <div id="modal-add-fund" class="modal fixed inset-0 z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-all duration-300">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="ui.closeModal('modal-add-fund')"></div>
        <div class="bg-surface2 border border-border w-full max-w-md p-8 rounded-3xl relative transform scale-95 transition-all duration-300 shadow-2xl mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white" id="modal-fund-title">Tambah Dana</h3>
                <button onclick="ui.closeModal('modal-add-fund')" class="text-textMuted hover:text-white transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <form onsubmit="handlers.submitFund(event)" class="space-y-5">
                <div class="relative group">
                    <label class="text-[10px] font-bold text-textMuted uppercase ml-1 mb-1 block">Jumlah Uang</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-textMuted font-bold group-focus-within:text-white transition-colors">Rp</span>
                        <input type="text" inputmode="decimal" name="amount" required placeholder="0" class="currency-input w-full bg-surface border border-border rounded-xl pl-12 pr-4 py-4 text-white focus:border-success focus:ring-1 focus:ring-success/50 focus:outline-none text-xl font-bold tracking-wide transition-all">
                    </div>
                </div>
                <button type="submit" class="w-full py-4 bg-success hover:bg-emerald-600 text-white rounded-xl font-bold shadow-glow mt-4 transition-all active:scale-95">
                    Simpan & Tabung
                </button>
            </form>
        </div>
    </div>
    
    <button onclick="ui.openModal('modal-add-transaction')" class="lg:hidden fixed bottom-6 right-6 w-14 h-14 bg-primary hover:bg-blue-600 text-white rounded-full shadow-glow-lg flex items-center justify-center z-40 animate-pulse-slow active:scale-90 transition-transform"><i class="fa-solid fa-plus text-xl"></i></button>

    <script>
        const DB_KEY = 'dyerz_ltd_v30_final_db';
        const SETTINGS_KEY = 'dyerz_ltd_v30_final_settings';

        const manifest = { "name": "DYERZ.LTD Finance", "short_name": "DYERZ", "description": "Financial Management OS", "start_url": window.location.href, "display": "standalone", "background_color": "#000000", "theme_color": "#000000", "icons": [{ "src": "https://cdn-icons-png.flaticon.com/512/5501/5501375.png", "sizes": "192x192", "type": "image/png" }, { "src": "https://cdn-icons-png.flaticon.com/512/5501/5501375.png", "sizes": "512x512", "type": "image/png" }] };
        const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        document.querySelector('#app-manifest').setAttribute('href', URL.createObjectURL(blob));

        const initialState = { 
            transactions: [], goals: [], 
            notifications: [{id: Date.now(), title: 'Selamat Datang!', msg: 'Selamat bergabung di DYERZ.LTD', read: false, time: new Date().toISOString()}], 
            profile: { name: 'Dyerz User', level: 'Free Plan', email: '', bio: '', photo: null, avatarColor: 'blue' }, 
            cards: [] 
        };
        const initialSettings = { budgetLimit: 0, security: { pin: null, bioEnabled: false }, sidebarPinned: false, privacyMode: false };
        
        let db = JSON.parse(localStorage.getItem(DB_KEY)) || initialState;
        let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY)) || initialSettings;
        if(!settings.security) settings.security = { pin: null, bioEnabled: false };
        if(!db.notifications) db.notifications = initialState.notifications;
        if(!db.cards) db.cards = [];

        let currentFilter = 'all';
        let longPressTimer;
        let currentGoalId = null; // Store ID for funding goal

        const sidebarSys = {
            el: null, mainWrapper: null, isPinned: false,
            init: () => {
                sidebarSys.el = document.getElementById('sidebar'); sidebarSys.mainWrapper = document.getElementById('main-wrapper');
                sidebarSys.isPinned = !!settings.sidebarPinned; sidebarSys.updateState();
                if(window.innerWidth >= 1024) { sidebarSys.el.addEventListener('mouseenter', sidebarSys.onEnter); sidebarSys.el.addEventListener('mouseleave', sidebarSys.onLeave); }
                window.addEventListener('resize', () => { if(window.innerWidth < 1024) { sidebarSys.el.style.width = ''; sidebarSys.mainWrapper.style.paddingLeft = '0'; sidebarSys.el.classList.remove('collapsed'); } else { sidebarSys.updateState(); } });
                const icon = document.getElementById('pin-icon'); const text = document.getElementById('pin-text'); if(sidebarSys.isPinned && icon) { icon.classList.remove('-rotate-45'); if(text) text.innerText = "Unpin Menu"; }
            },
            togglePin: () => { sidebarSys.isPinned = !sidebarSys.isPinned; settings.sidebarPinned = sidebarSys.isPinned; utils.save(); const icon = document.getElementById('pin-icon'); const text = document.getElementById('pin-text'); if(sidebarSys.isPinned) { icon.classList.remove('-rotate-45'); text.innerText = "Unpin Menu"; ui.showToast("Menu Dikunci"); } else { icon.classList.add('-rotate-45'); text.innerText = "Pin Menu"; ui.showToast("Mode Auto-Hover"); } sidebarSys.updateState(); },
            onEnter: () => { if(!sidebarSys.isPinned) sidebarSys.expand(); },
            onLeave: () => { if(!sidebarSys.isPinned) sidebarSys.collapse(); },
            updateState: () => { if(window.innerWidth < 1024) return; if(sidebarSys.isPinned) { sidebarSys.expand(); } else { sidebarSys.collapse(); } },
            expand: () => { sidebarSys.el.classList.remove('w-20', 'collapsed'); sidebarSys.el.classList.add('w-72'); sidebarSys.mainWrapper.classList.remove('lg:pl-20'); sidebarSys.mainWrapper.classList.add('lg:pl-72'); },
            collapse: () => { sidebarSys.el.classList.remove('w-72'); sidebarSys.el.classList.add('w-20', 'collapsed'); sidebarSys.mainWrapper.classList.remove('lg:pl-72'); sidebarSys.mainWrapper.classList.add('lg:pl-20'); }
        };

        const security = {
            buffer: '', mode: 'login', tempPin: '', onVerifySuccess: null, isScanning: false,
            checkLock: () => { if(settings.security.pin && !sessionStorage.getItem('unlocked')) { document.getElementById('lock-screen').classList.remove('hidden'); setTimeout(app.hideStartup, 800); } else { setTimeout(app.hideStartup, 1500); } },
            lockApp: () => { if(!settings.security.pin) return ui.showToast('Buat PIN dulu', 'error'); security.setMode('login'); document.getElementById('lock-screen').classList.remove('hidden'); },
            setMode: (m, msg) => { security.mode = m; security.buffer = ''; security.updateDots(); const t=document.getElementById('lock-title'), ms=document.getElementById('lock-msg'), c=document.getElementById('btn-cancel-lock'), f=document.getElementById('btn-forgot-pin'); if(m==='login'){t.innerText="DYERZ Security";ms.innerText="Masukkan PIN untuk masuk";c.classList.add('hidden');f.classList.remove('hidden');} else if(m==='setup_new'){t.innerText="Buat PIN Baru";ms.innerText="Masukkan 6 digit angka";c.classList.remove('hidden');f.classList.add('hidden');} else if(m==='setup_confirm'){t.innerText="Konfirmasi PIN";ms.innerText="Masukkan ulang PIN anda";c.classList.remove('hidden');f.classList.add('hidden');} else if(m==='verify'){t.innerText="Verifikasi";ms.innerText=msg||"Masukkan PIN";c.classList.remove('hidden');f.classList.add('hidden');} },
            verifyIdentity: (cb, msg) => { if(settings.security.pin){security.onVerifySuccess=cb;document.getElementById('lock-screen').classList.remove('hidden');security.setMode('verify',msg);}else{if(confirm("Keamanan belum diatur. Lanjut?"))cb();} },
            cancelVerify: () => { document.getElementById('lock-screen').classList.add('hidden'); security.buffer=''; security.onVerifySuccess=null; },
            typePin: (n) => { if(security.buffer.length<6){security.buffer+=n;security.updateDots();if(security.buffer.length===6)setTimeout(security.processPin,200);} },
            delPin: () => { security.buffer=security.buffer.slice(0,-1);security.updateDots(); },
            updateDots: () => { document.querySelectorAll('.pin-dot').forEach((d,i)=>{if(i<security.buffer.length){d.classList.add('bg-primary','scale-110');d.classList.remove('bg-border');}else{d.classList.remove('bg-primary','scale-110');d.classList.add('bg-border');}}); },
            processPin: () => {
                if(security.mode==='login'){ if(security.buffer===settings.security.pin){document.getElementById('lock-screen').classList.add('hidden');security.buffer='';app.hideStartup();ui.showToast('Akses Diberikan');}else{security.handleError();} }
                else if(security.mode==='verify'){ if(security.buffer===settings.security.pin){document.getElementById('lock-screen').classList.add('hidden');security.buffer='';if(security.onVerifySuccess)security.onVerifySuccess();}else{security.handleError();} }
                else if(security.mode==='setup_new'){ security.tempPin=security.buffer; security.setMode('setup_confirm'); }
                else if(security.mode==='setup_confirm'){ if(security.buffer===security.tempPin){settings.security.pin=security.buffer;settings.security.bioEnabled=false;utils.save();ui.showToast('PIN Dibuat');security.tempPin='';document.getElementById('lock-screen').classList.add('hidden');app.renderSettings();}else{ui.showToast('PIN Tidak Cocok','error');security.setMode('setup_new');} }
            },
            handleError: () => { ui.showToast('PIN Salah','error'); const b=document.querySelector('#lock-screen>div'); b.classList.remove('animate-slide-up'); b.classList.add('animate-shake'); setTimeout(()=>{b.classList.remove('animate-shake');security.buffer='';security.updateDots();},500); },
            togglePinFlow: () => { if(settings.security.pin){security.verifyIdentity(()=>{settings.security.pin=null;settings.security.bioEnabled=false;utils.save();ui.showToast('PIN Dihapus');app.renderSettings();},"Hapus PIN?");}else{document.getElementById('lock-screen').classList.remove('hidden');security.setMode('setup_new');} },
            startScan: () => { if(!settings.security.bioEnabled) return; security.isScanning = true; document.getElementById('fingerprint-btn').classList.add('scanning'); longPressTimer = setTimeout(() => { if(security.isScanning) security.biometricSuccess(); }, 1500); },
            endScan: () => { security.isScanning = false; clearTimeout(longPressTimer); document.getElementById('fingerprint-btn').classList.remove('scanning'); },
            biometricSuccess: () => { document.getElementById('fingerprint-btn').classList.remove('scanning'); ui.showToast('Identitas Terverifikasi'); if(security.mode==='login'){document.getElementById('lock-screen').classList.add('hidden');app.hideStartup();} else if(security.mode==='verify'){document.getElementById('lock-screen').classList.add('hidden');if(security.onVerifySuccess)security.onVerifySuccess();} },
            biometricScan: () => { if(!settings.security.bioEnabled) return ui.showToast('Aktifkan di Pengaturan', 'error'); ui.showToast('Tekan & Tahan untuk Scan', 'warning'); },
            toggleBiometric: (el) => { if(!settings.security.pin){el.checked=false;return ui.showToast('Buat PIN dulu','error');} settings.security.bioEnabled=el.checked; utils.save(); ui.showToast(el.checked?'Bio Aktif':'Bio Non-aktif'); },
            forgotPin: () => { if(confirm("Reset Data Total untuk buka kunci?")) { localStorage.removeItem(DB_KEY); localStorage.removeItem(SETTINGS_KEY); location.reload(); } }
        };

        const utils = {
            formatIDR: (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n),
            formatDate: (d) => new Date(d).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' }),
            genId: () => Date.now().toString(36) + Math.random().toString(36).substr(2),
            save: () => { localStorage.setItem(DB_KEY, JSON.stringify(db)); localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings)); app.refresh(); },
            getIcon: (c) => ({'Makanan':'fa-utensils','Transportasi':'fa-car','Belanja':'fa-bag-shopping','Tagihan':'fa-file-invoice-dollar','Hiburan':'fa-film','Investasi':'fa-chart-line','Gaji':'fa-money-bill-wave','Bonus':'fa-gift'}[c]||'fa-circle'),
            getAvatarGradient: (c) => ({'blue':'bg-gradient-to-tr from-primary to-cyan-400','purple':'bg-gradient-to-tr from-accent to-pink-500','green':'bg-gradient-to-tr from-emerald-500 to-lime-400','gold':'bg-gradient-to-tr from-yellow-500 to-orange-500'}[c]||'bg-gray-500'),
            parseCurrency: (str) => { if(!str) return 0; try { return parseFloat(str.toString().replace(/\./g, '').replace(/,/g, '.').replace(/\s/g,'')); } catch(e) { return 0; } }
        };

        const ui = {
            toggleMobileSidebar: () => { const sb=document.getElementById('sidebar'); const ol=document.getElementById('mobile-overlay'); sb.classList.toggle('-translate-x-full'); ol.classList.toggle('hidden'); },
            toggleSidebarPin: () => { sidebarSys.togglePin(); },
            openModal: (id) => { 
                const m=document.getElementById(id); m.classList.remove('opacity-0','pointer-events-none'); m.querySelector('.transform').classList.remove('scale-95'); m.querySelector('.transform').classList.add('scale-100'); 
                if(id==='modal-add-transaction'){document.querySelector('input[name="date"]').valueAsDate=new Date();ui.updateCategoryOptions('income');} 
                if(id==='modal-profile'){
                    document.getElementById('input-profile-name').value=db.profile.name;
                    document.getElementById('input-profile-level').value=db.profile.level;
                    document.getElementById('input-profile-email').value=db.profile.email||'';
                    document.getElementById('input-profile-bio').value=db.profile.bio||'';
                    document.getElementById('profile-preview-badge').innerText = db.profile.level;
                    const pvImg=document.getElementById('preview-img');const pvInit=document.getElementById('preview-initial');
                    if(db.profile.photo){pvImg.src=db.profile.photo;pvImg.classList.remove('hidden');pvInit.classList.add('hidden');}else{pvImg.classList.add('hidden');pvInit.classList.remove('hidden');pvInit.innerText=db.profile.name.charAt(0).toUpperCase();}
                    document.getElementsByName('avatarColor').forEach(r=>{if(r.value===(db.profile.avatarColor||'blue'))r.checked=true;});
                }
                ui.attachCurrencyListeners(); ui.attachCardListeners(); 
            },
            closeModal: (id) => { const m=document.getElementById(id); m.classList.add('opacity-0','pointer-events-none'); m.querySelector('.transform').classList.remove('scale-100'); m.querySelector('.transform').classList.add('scale-95'); const f=m.querySelector('form'); if(f)f.reset(); },
            showToast: (m,t='success') => { const c=document.getElementById('toast-container'); const el=document.createElement('div'); el.className=`toast pointer-events-auto flex items-center gap-3 px-4 py-3 rounded-xl bg-surface2 border ${t==='success'?'border-success/30':'border-danger/30'} text-xs font-bold text-white shadow-xl min-w-[280px]`; el.innerHTML=`<i class="fa-solid ${t==='success'?'fa-circle-check text-success':'fa-circle-exclamation text-danger'}"></i><span>${m}</span>`; c.appendChild(el); setTimeout(()=>{el.classList.add('hiding');el.addEventListener('animationend',()=>el.remove());},3000); },
            updateCategoryOptions: (t) => { const s=document.getElementById('trx-category-select'); s.innerHTML=''; (t==='income'?['Gaji','Bonus','Investasi','Penjualan','Lainnya']:['Makanan','Transportasi','Belanja','Tagihan','Hiburan','Kesehatan','Investasi','Lainnya']).forEach(c=>{const o=document.createElement('option');o.value=c;o.innerText=c;s.appendChild(o);}); },
            attachCurrencyListeners: () => { document.querySelectorAll('.currency-input').forEach(i => { i.oninput = function(e) { let val = e.target.value.replace(/\D/g, ''); if(val === "") { e.target.value = ""; return; } e.target.value = new Intl.NumberFormat('id-ID').format(val); }; }); },
            attachCardListeners: () => { document.querySelectorAll('.card-num-input').forEach(i => { i.oninput = function(e) { let v = e.target.value.replace(/\D/g, '').substring(0, 16); let parts = []; for(let i=0; i<v.length; i+=4) parts.push(v.substring(i, i+4)); e.target.value = parts.join(' '); } }); document.querySelectorAll('.valid-thru-input').forEach(i => { i.oninput = function(e) { let v = e.target.value.replace(/\D/g, '').substring(0, 4); if(v.length >= 2) e.target.value = v.substring(0, 2) + '/' + v.substring(2); else e.target.value = v; } }); },
            confetti: () => { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#2563eb', '#7c3aed', '#059669'] }); },
            toggleNotifications: () => { const panel = document.getElementById('notification-panel'); if(panel.classList.contains('hidden')) { panel.classList.remove('hidden'); setTimeout(() => { panel.classList.remove('opacity-0', 'scale-95'); db.notifications.forEach(n => n.read = true); utils.save(); ui.renderNotifications(); }, 10); } else { panel.classList.add('opacity-0', 'scale-95'); setTimeout(() => { panel.classList.add('hidden'); }, 200); } },
            clearNotifications: () => { db.notifications = []; utils.save(); ui.renderNotifications(); },
            renderNotifications: () => { const list = document.getElementById('notification-list'); const dot = document.getElementById('notif-dot'); list.innerHTML = ''; const unread = db.notifications.filter(n => !n.read).length; dot.classList.toggle('hidden', unread === 0); if(db.notifications.length === 0) { list.innerHTML = `<p class="text-center text-[10px] text-textMuted py-6">Tidak ada notifikasi baru</p>`; } else { db.notifications.slice().reverse().forEach(n => { const bgClass = n.read ? 'bg-white/5 border-white/5' : 'bg-primary/10 border-primary/20'; list.innerHTML += `<div class="p-3 rounded-xl border ${bgClass} hover:bg-white/10 transition-all cursor-pointer relative group mb-2" onclick="ui.toggleNotifications()"><div class="flex justify-between items-start mb-1 pr-4"><h5 class="text-xs font-bold text-white ${n.read ? '' : 'text-primary'}">${n.title}</h5><span class="text-[9px] text-textMuted font-mono">${new Date(n.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span></div><p class="text-[10px] text-textMuted leading-relaxed">${n.msg}</p></div>`; }); } },
            togglePrivacy: () => { settings.privacyMode = !settings.privacyMode; utils.save(); ui.updatePrivacyIcon(); app.refresh(); },
            updatePrivacyIcon: () => { const icon = document.getElementById('privacy-icon'); if(icon) icon.className = settings.privacyMode ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'; },
            renderCards: () => {
                const container = document.getElementById('wallet-cards-container'); container.innerHTML = '';
                if(db.cards.length === 0) { container.innerHTML = `<div class="glass-solid p-10 rounded-3xl text-center border-dashed border border-border/50"><div class="w-16 h-16 bg-surface border border-border rounded-full flex items-center justify-center mx-auto mb-4 text-textMuted"><i class="fa-solid fa-credit-card text-2xl"></i></div><h4 class="text-white font-bold">Dompet Kosong</h4><p class="text-xs text-textMuted mt-1 mb-4">Tambahkan kartu ATM pertama Anda</p><button onclick="ui.openModal('modal-add-card')" class="text-primary hover:underline text-xs font-bold">Buat Kartu Baru</button></div>`; } else {
                    db.cards.forEach(card => {
                        const theme = `theme-${card.bank || 'default'}`; const formattedBal = utils.formatIDR(card.balance); const displayBal = settings.privacyMode ? "Rp â€¢â€¢â€¢â€¢â€¢â€¢â€¢" : formattedBal; const accNum = card.number || "0000000000"; const displayCardNum = card.cardnum || "â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢"; const displayValid = card.valid || "MM/YY";
                        container.innerHTML += `<div class="atm-card ${theme} p-6 relative group cursor-pointer" data-tilt data-tilt-glare data-tilt-max-glare="0.3"><div class="flex justify-between items-start mb-8 relative z-10"><div class="card-chip shadow-md"></div><i class="fa-solid fa-wifi rotate-90 opacity-70"></i></div><h3 class="card-number text-xl md:text-2xl font-bold tracking-widest mb-2 z-10 relative">${displayCardNum}</h3><div class="flex justify-center gap-4 mb-2 text-[10px] opacity-80 font-mono relative z-10"><span>VALID THRU: ${displayValid}</span></div><div class="flex justify-between items-end relative z-10"><div><p class="text-[10px] opacity-70 uppercase tracking-wider mb-1">Card Holder</p><p class="font-bold text-sm tracking-wide uppercase">${card.holder}</p><p class="text-[10px] font-mono mt-1 opacity-80">REK: ${accNum}</p></div><div class="text-right"><p class="bank-logo text-lg opacity-90">${card.bank.toUpperCase()}</p><p class="text-xs font-mono font-bold mt-1 opacity-80">${displayBal}</p></div></div><div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3 backdrop-blur-sm z-20"><button onclick="handlers.topUpCard('${card.id}')" class="px-4 py-2 bg-white text-black rounded-lg text-xs font-bold hover:scale-105 transition-transform">Isi Saldo</button><button onclick="handlers.deleteCard('${card.id}')" class="px-4 py-2 bg-danger text-white rounded-lg text-xs font-bold hover:scale-105 transition-transform"><i class="fa-solid fa-trash"></i></button></div></div>`;
                    });
                    VanillaTilt.init(document.querySelectorAll(".atm-card"));
                }
                document.getElementById('wallet-total-cards').innerText = db.cards.length;
                document.getElementById('wallet-total-balance').innerText = settings.privacyMode ? "Rp â€¢â€¢â€¢â€¢â€¢â€¢â€¢" : utils.formatIDR(db.cards.reduce((a, c) => a + c.balance, 0));
            }
        };

        const router = {
            navigate: (page) => {
                document.querySelectorAll('.nav-item').forEach(el => { const active = el.dataset.page === page; el.classList.toggle('bg-white/5', active); el.classList.toggle('text-white', active); el.classList.toggle('text-textMuted', !active); });
                document.getElementById('page-title').innerText = page.charAt(0).toUpperCase() + page.slice(1);
                document.querySelectorAll('.page-view').forEach(v => { v.classList.add('hidden'); v.classList.remove('animate-slide-up'); });
                const activeView = document.getElementById(`view-${page}`); activeView.classList.remove('hidden'); void activeView.offsetWidth; activeView.classList.add('animate-slide-up');
                if(window.innerWidth < 1024) { const sb=document.getElementById('sidebar'); if(!sb.classList.contains('-translate-x-full')) ui.toggleMobileSidebar(); }
                if(page==='budget') app.renderBudget(); if(page==='settings') app.renderSettings(); if(page==='wallet') ui.renderCards();
            }
        };

        const handlers = {
            submitTransaction: (e) => { 
                e.preventDefault(); 
                const fd=new FormData(e.target); 
                const amt=utils.parseCurrency(fd.get('amount')); 
                if(amt<=0) return ui.showToast('Jumlah harus valid','error'); 
                const type = fd.get('type');
                db.transactions.push({
                    id:utils.genId(), 
                    type: type, 
                    amount:amt, 
                    desc:fd.get('desc'), 
                    category:fd.get('category'), 
                    date:fd.get('date')||new Date().toISOString()
                }); 
                db.notifications.push({id: Date.now(), title: 'Transaksi Baru', msg: `${type==='income'?'Pemasukan':'Pengeluaran'} sebesar IDR ${utils.formatIDR(amt)} dicatat.`, read: false, time: new Date().toISOString()}); 
                utils.save(); 
                ui.closeModal('modal-add-transaction'); 
                ui.showToast('Data Tersimpan'); 
                if(type==='income') ui.confetti(); 
                app.refresh(); 
            },
            submitGoal: (e) => { e.preventDefault(); const fd=new FormData(e.target); db.goals.push({id:utils.genId(),name:fd.get('name'),target:utils.parseCurrency(fd.get('target')),current:utils.parseCurrency(fd.get('current'))||0,color:fd.get('color')}); db.notifications.push({id: Date.now(), title: 'Target Baru', msg: `Target '${fd.get('name')}' berhasil dibuat.`, read: false, time: new Date().toISOString()}); utils.save(); ui.closeModal('modal-add-goal'); ui.showToast('Target Dibuat'); ui.confetti(); },
            submitCard: (e) => { e.preventDefault(); const fd=new FormData(e.target); const bal = utils.parseCurrency(fd.get('balance')); db.cards.push({ id: utils.genId(), bank: fd.get('bank'), holder: fd.get('holder'), balance: bal, number: fd.get('number'), cardnum: fd.get('cardnum'), valid: fd.get('valid') }); utils.save(); ui.closeModal('modal-add-card'); ui.showToast('Kartu Ditambahkan'); ui.renderCards(); app.refresh(); },
            deleteCard: (id) => { if(confirm("Hapus kartu?")) { db.cards = db.cards.filter(c => c.id !== id); utils.save(); ui.showToast('Kartu Dihapus'); ui.renderCards(); app.refresh(); } },
            topUpCard: (id) => { const card = db.cards.find(c => c.id === id); const amtStr = prompt(`Top Up (Angka):`); const amt = parseFloat(amtStr); if(amt > 0) { card.balance += amt; db.notifications.push({id: Date.now(), title: 'Top Up Berhasil', msg: `Saldo ${card.bank.toUpperCase()} bertambah IDR ${utils.formatIDR(amt)}`, read: false, time: new Date().toISOString()}); utils.save(); ui.showToast('Saldo Diisi'); ui.confetti(); ui.renderCards(); app.refresh(); } },
            updateProfile: (e) => { 
                e.preventDefault(); 
                db.profile.name = document.getElementById('input-profile-name').value; 
                db.profile.level = document.getElementById('input-profile-level').value; 
                db.profile.email = document.getElementById('input-profile-email').value; 
                db.profile.bio = document.getElementById('input-profile-bio').value; 
                document.getElementsByName('avatarColor').forEach(r=>{if(r.checked)db.profile.avatarColor=r.value;}); 
                utils.save(); 
                ui.closeModal('modal-profile'); 
                ui.showToast('Profil Diperbarui'); 
                app.refresh(); 
            },
            handlePhotoUpload: (input) => { if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = function (e) { db.profile.photo = e.target.result; document.getElementById('preview-img').src = e.target.result; document.getElementById('preview-img').classList.remove('hidden'); document.getElementById('preview-initial').classList.add('hidden'); }; reader.readAsDataURL(input.files[0]); } },
            
            // --- ADD FUNDS TO GOAL ---
            addGoalFund: (id) => {
                currentGoalId = id; // Store target goal ID
                const goal = db.goals.find(g => g.id === id);
                document.getElementById('modal-fund-title').innerText = `Tabung ke ${goal.name}`;
                ui.openModal('modal-add-fund');
            },
            
            // --- SUBMIT FUND ---
            submitFund: (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const amt = utils.parseCurrency(fd.get('amount'));
                
                if(amt <= 0) return ui.showToast('Jumlah harus valid', 'error');
                
                // Find Goal
                const goalIndex = db.goals.findIndex(g => g.id === currentGoalId);
                if(goalIndex !== -1) {
                    const goal = db.goals[goalIndex];
                    goal.current += amt;
                    
                    // Log as Expense
                    db.transactions.push({
                        id: utils.genId(),
                        type: 'expense',
                        amount: amt,
                        category: 'Investasi',
                        desc: `Tabungan: ${goal.name}`,
                        date: new Date().toISOString()
                    });
                    
                    utils.save();
                    ui.closeModal('modal-add-fund');
                    ui.showToast(`Berhasil menabung IDR ${utils.formatIDR(amt)}`);
                    ui.confetti();
                    app.refresh();
                }
            },
            
            importCSV: (input) => {
                const file = input.files[0];
                if(!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const text = e.target.result;
                    const lines = text.split('\n');
                    let currentSection = null;
                    let counts = { trx:0, cards:0, goals:0 };
                    lines.forEach(line => {
                        line = line.trim(); if(!line) return;
                        if(line.startsWith('[SECTION:')) { currentSection = line; return; }
                        if(line.startsWith('Name,Level') || line.startsWith('ID,Bank') || line.startsWith('ID,Name') || line.startsWith('ID,Date')) return;
                        const cols = line.split(',');
                        try {
                            if(currentSection === '[SECTION:PROFILE]' && cols.length >= 4) { db.profile.name = cols[0].replace(/"/g,''); db.profile.level = cols[1].replace(/"/g,''); db.profile.email = cols[2].replace(/"/g,''); db.profile.bio = cols[3].replace(/"/g,''); }
                            else if(currentSection === '[SECTION:CARDS]' && cols.length >= 7) { db.cards.push({ id: cols[0], bank: cols[1], holder: cols[2].replace(/"/g,''), number: cols[3], cardnum: cols[4], valid: cols[5], balance: parseFloat(cols[6]) }); counts.cards++; }
                            else if(currentSection === '[SECTION:GOALS]' && cols.length >= 5) { db.goals.push({ id: cols[0], name: cols[1].replace(/"/g,''), target: parseFloat(cols[2]), current: parseFloat(cols[3]), color: cols[4] }); counts.goals++; }
                            else if((currentSection === '[SECTION:TRANSACTIONS]' || !currentSection) && cols.length >= 6) { db.transactions.push({ id: cols[0], date: cols[1], type: cols[2], category: cols[3], desc: cols[4].replace(/"/g, ''), amount: parseFloat(cols[5]) }); counts.trx++; }
                        } catch(err) {}
                    });
                    utils.save(); ui.showToast(`Pulih: ${counts.trx} Trx, ${counts.cards} Kartu`); app.refresh(); input.value = '';
                };
                reader.readAsText(file);
            },
            deleteItem: (t,id) => { if(!confirm('Hapus?'))return; if(t==='trx')db.transactions=db.transactions.filter(x=>x.id!==id); if(t==='goal')db.goals=db.goals.filter(x=>x.id!==id); utils.save(); ui.showToast('Dihapus'); app.refresh(); },
            search: (q) => { if(!q)return filters.set('all'); router.navigate('transactions'); const r=db.transactions.filter(t=>t.desc.toLowerCase().includes(q.toLowerCase())); app.renderTransactions(r); },
            deleteNotification: (id) => { db.notifications = db.notifications.filter(n => n.id !== id); utils.save(); ui.renderNotifications(); },
            exportFullCSV: () => {
                if(db.transactions.length === 0 && db.cards.length === 0 && db.goals.length === 0) return ui.showToast('Data Kosong', 'error');
                let csv = "[SECTION:PROFILE]\nName,Level,Email,Bio\n" + `"${db.profile.name}","${db.profile.level}","${db.profile.email||''}","${db.profile.bio||''}"\n\n` +
                          "[SECTION:CARDS]\nID,Bank,Holder,Number,CardNum,Valid,Balance\n" + db.cards.map(c => `${c.id},${c.bank},"${c.holder}",${c.number},${c.cardnum},${c.valid},${c.balance}`).join("\n") + "\n\n" +
                          "[SECTION:GOALS]\nID,Name,Target,Current,Color\n" + db.goals.map(g => `${g.id},"${g.name}",${g.target},${g.current},${g.color}`).join("\n") + "\n\n" +
                          "[SECTION:TRANSACTIONS]\nID,Date,Type,Category,Desc,Amount\n" + db.transactions.map(t => `${t.id},${t.date},${t.type},${t.category},"${t.desc}",${t.amount}`).join("\n");
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = `DYERZ_Full_Backup_${new Date().toISOString().slice(0,10)}.csv`; document.body.appendChild(link); link.click(); document.body.removeChild(link); ui.showToast('Backup Berhasil');
            }
        };

        const filters = { set: (t) => { currentFilter=t; document.querySelectorAll('.filter-btn').forEach(b=>{const a=b.getAttribute('onclick').includes(t); b.classList.toggle('active',a); b.classList.toggle('bg-primary',a); b.classList.toggle('text-white',a); b.classList.toggle('text-textMuted',!a);}); app.renderTransactions(); } };

        const chartSys = {
            inst: null,
            init: () => {
                const ctx = document.getElementById('mainChart').getContext('2d');
                const grad = (c) => { const g = ctx.createLinearGradient(0,0,0,300); g.addColorStop(0,c+'66'); g.addColorStop(1,c+'00'); return g; };
                chartSys.inst = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [ 
                        { label: 'Masuk', borderColor: '#059669', backgroundColor: grad('#059669'), fill: true, tension: 0.4, data: [] }, 
                        { label: 'Keluar', borderColor: '#dc2626', backgroundColor: grad('#dc2626'), fill: true, tension: 0.4, data: [] },
                        { label: 'Net Flow', borderColor: '#3b82f6', borderDash: [5, 5], borderWidth: 2, fill: false, tension: 0.4, data: [] }
                    ]},
                    options: { responsive: true, maintainAspectRatio: false, interaction: {intersect: false, mode: 'index'}, plugins: { legend: {labels: {color:'#737373'}}, tooltip: {backgroundColor: '#0f0f11', titleColor:'#fff', bodyColor:'#a1a1aa', borderColor:'#333', borderWidth:1} }, scales: { y: {grid:{color:'#1f1f22'}, ticks:{color:'#737373'}}, x: {grid:{display:false}, ticks:{color:'#737373'}} } }
                });
            },
            update: () => {
                const dates = []; for(let i=6; i>=0; i--) { const d=new Date(); d.setDate(d.getDate()-i); dates.push(d.toISOString().split('T')[0]); }
                const inc=new Array(7).fill(0), exp=new Array(7).fill(0), net=new Array(7).fill(0);
                
                db.transactions.forEach(t => { 
                    const d=t.date.split('T')[0]; const idx=dates.indexOf(d); 
                    if(idx!==-1) { 
                        if(t.type==='income') inc[idx]+=t.amount; else exp[idx]+=t.amount; 
                    } 
                });
                for(let i=0; i<7; i++) net[i] = inc[i] - exp[i];

                chartSys.inst.data.labels = dates.map(d => new Date(d).toLocaleDateString('id-ID', {weekday:'short'}));
                chartSys.inst.data.datasets[0].data = inc; 
                chartSys.inst.data.datasets[1].data = exp;
                chartSys.inst.data.datasets[2].data = net;
                chartSys.inst.update();
            }
        };

        const app = {
            init: () => {
                document.getElementById('current-date').innerText = new Date().toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
                if(settings.budgetLimit) document.getElementById('budget-limit-input').value = new Intl.NumberFormat('id-ID').format(settings.budgetLimit);
                
                security.checkLock();
                setTimeout(() => { const s = document.getElementById('startup-screen'); if(s && getComputedStyle(s).opacity !== '0' && !settings.security.pin) { app.hideStartup(); } }, 4000);

                sidebarSys.init(); chartSys.init(); ui.attachCurrencyListeners(); ui.attachCardListeners();
                ui.updatePrivacyIcon();
                app.refresh();
            },
            hideStartup: () => { const s = document.getElementById('startup-screen'); const l = document.getElementById('loader-progress'); const t = document.getElementById('startup-text'); if(!s) return; l.style.width = '100%'; if(t) t.innerText = "SYSTEM READY"; setTimeout(() => { s.style.opacity = '0'; s.style.pointerEvents = 'none'; setTimeout(() => { s.style.visibility = 'hidden'; }, 500); }, 500); },
            refresh: () => {
                if(!db.profile) db.profile = { name: 'Dyerz User', level: 'Free Plan', avatarColor: 'blue' };
                document.getElementById('sidebar-name').innerText = db.profile.name;
                document.getElementById('banner-name').innerText = db.profile.name.split(' ')[0];
                document.getElementById('sidebar-avatar-text').innerText = db.profile.name.charAt(0).toUpperCase();
                const sbAvatarBg = document.getElementById('sidebar-avatar-bg');
                const sbAvatarTxt = document.getElementById('sidebar-avatar-text');
                if(db.profile.photo) { sbAvatarBg.style.backgroundImage = `url(${db.profile.photo})`; sbAvatarBg.style.backgroundSize = 'cover'; sbAvatarTxt.classList.add('hidden'); sbAvatarBg.classList.remove(utils.getAvatarGradient(db.profile.avatarColor)); } else { sbAvatarBg.style.backgroundImage = ''; sbAvatarTxt.classList.remove('hidden'); sbAvatarBg.className = `w-9 h-9 rounded-lg flex items-center justify-center relative z-10 font-bold text-white shadow-lg shrink-0 text-sm ${utils.getAvatarGradient(db.profile.avatarColor)}`; }
                document.getElementById('sidebar-level').innerText = db.profile.level;
                
                const now = new Date(); let i=0, e=0, b=0;
                db.transactions.forEach(t => { if(t.type==='income') b+=t.amount; else b-=t.amount; const d=new Date(t.date); if(d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear()) { if(t.type==='income') i+=t.amount; else e+=t.amount; } });
                
                const cardTotal = db.cards.reduce((sum, c) => sum + c.balance, 0);
                const netWorth = b + cardTotal;

                const hideTxt = "Rp â€¢â€¢â€¢â€¢â€¢â€¢â€¢";
                document.getElementById('dash-balance').innerText = settings.privacyMode ? hideTxt : utils.formatIDR(netWorth);
                document.getElementById('dash-income').innerText = settings.privacyMode ? hideTxt : utils.formatIDR(i);
                document.getElementById('dash-expense').innerText = settings.privacyMode ? hideTxt : utils.formatIDR(e);
                
                document.getElementById('welcome-banner').classList.toggle('hidden', db.transactions.length > 0);
                
                ui.renderNotifications(); app.renderTransactions(); app.renderGoals(); app.renderBudget(); chartSys.update();
            },
            renderTransactions: (cd=null) => {
                let d = cd || [...db.transactions].sort((a,b)=>new Date(b.date)-new Date(a.date));
                if(currentFilter!=='all' && !cd) d=d.filter(t=>t.type===currentFilter);
                
                // Desktop
                const tb = document.getElementById('transaction-table-body'); 
                if(tb) tb.innerHTML='';
                
                // Mobile & Dashboard List
                const mobList = document.getElementById('transaction-mobile-list'); 
                if(mobList) mobList.innerHTML = '';
                
                const dashList = document.getElementById('dash-recent-list');
                if(dashList) dashList.innerHTML = '';

                if(d.length===0 && dashList) dashList.innerHTML=`<div class="h-full flex flex-col items-center justify-center text-textMuted opacity-50"><i class="fa-solid fa-receipt text-2xl mb-2"></i><p class="text-xs">Belum ada data</p></div>`;

                d.forEach((t, index) => { 
                    const inc=t.type==='income'; 
                    const icon = utils.getIcon(t.category);
                    
                    // Desktop Table Row
                    if(tb) {
                        tb.innerHTML+=`<tr class="hover:bg-white/5 transition-colors group"><td class="px-6 py-4 text-textMuted font-mono text-xs">${utils.formatDate(t.date)}</td><td class="px-6 py-4"><span class="px-2.5 py-1 text-[10px] font-bold uppercase tracking-wider rounded-lg ${inc?'bg-success/10 text-success':'bg-white/10 text-white'}">${t.category}</span></td><td class="px-6 py-4 font-bold text-white">${t.desc}</td><td class="px-6 py-4 font-bold text-right ${inc?'text-success':'text-danger'}">${inc?'+':'-'} ${utils.formatIDR(t.amount)}</td><td class="px-6 py-4 text-center"><button onclick="handlers.deleteItem('trx','${t.id}')" class="p-2 text-textMuted hover:text-danger hover:bg-danger/10 rounded-lg transition-all opacity-0 group-hover:opacity-100"><i class="fa-solid fa-trash-can"></i></button></td></tr>`;
                    }

                    // Mobile Card
                    if(mobList) {
                        mobList.innerHTML+=`
                        <div class="p-4 rounded-2xl bg-surface2 border border-white/5 hover:border-white/10 transition-all">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full ${inc?'bg-success/10 text-success':'bg-white/5 text-white'} flex items-center justify-center shrink-0"><i class="fa-solid ${icon}"></i></div>
                                    <div><h4 class="text-sm font-bold text-white">${t.desc}</h4><p class="text-xs text-textMuted">${utils.formatDate(t.date)} â€¢ ${t.category}</p></div>
                                </div>
                                <button onclick="handlers.deleteItem('trx','${t.id}')" class="text-textMuted hover:text-danger p-2"><i class="fa-solid fa-trash-can"></i></button>
                            </div>
                            <div class="flex justify-between items-end"><span class="text-[10px] px-2 py-1 rounded bg-black/50 text-textMuted uppercase tracking-wider">${inc ? 'Pemasukan' : 'Pengeluaran'}</span><span class="text-lg font-bold ${inc?'text-success':'text-danger'}">${inc?'+':'-'} ${utils.formatIDR(t.amount)}</span></div>
                        </div>`; 
                    }

                    // Dashboard Recent List (Limit to top 10 or fit scrolling)
                    if(dashList && index < 10) {
                         dashList.innerHTML+=`
                            <div class="flex items-center justify-between p-3 rounded-xl bg-surface2/50 hover:bg-surface2 border border-transparent hover:border-white/5 transition-all group cursor-pointer" onclick="router.navigate('transactions')">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full ${inc?'bg-success/10 text-success':'bg-white/5 text-white'} flex items-center justify-center shrink-0"><i class="fa-solid ${icon} text-xs"></i></div>
                                    <div class="min-w-0"><p class="text-xs font-bold text-white truncate">${t.desc}</p><p class="text-[9px] text-textMuted truncate">${utils.formatDate(t.date)}</p></div>
                                </div>
                                <span class="text-xs font-bold ${inc?'text-success':'text-danger'} whitespace-nowrap">${inc?'+':'-'} ${utils.formatIDR(t.amount)}</span>
                            </div>
                         `;
                    }
                });
            },
            renderGoals: () => {
                const c = document.getElementById('goals-container'); c.innerHTML='';
                document.getElementById('empty-state-goals').classList.toggle('hidden', db.goals.length > 0);
                db.goals.forEach(g => {
                    const p = Math.min(100, Math.round((g.current/g.target)*100));
                    const col = ({'primary':'#3b82f6','accent':'#7c3aed','success':'#059669','warning':'#d97706'}[g.color]||'#3b82f6');
                    c.innerHTML += `<div class="glass-solid p-6 rounded-3xl relative overflow-hidden group hover-card flex flex-col justify-between min-h-[220px]" style="border-color:${col}33"><div class="relative z-10"><div class="flex justify-between items-start mb-6"><div class="w-12 h-12 rounded-2xl flex items-center justify-center text-xl shadow-lg transition-transform group-hover:scale-110" style="background:${col}20; color:${col}"><i class="fa-solid fa-trophy"></i></div><div class="px-3 py-1 rounded-lg bg-surface border border-border text-xs font-bold text-white font-mono">${p}%</div></div><h4 class="text-xl font-bold text-white mb-1">${g.name}</h4><div class="flex justify-between text-xs text-textMuted mb-4 font-mono"><span>${utils.formatIDR(g.current)}</span><span>${utils.formatIDR(g.target)}</span></div><div class="w-full bg-surface h-3 rounded-full overflow-hidden border border-white/5"><div class="h-full rounded-full transition-all duration-1000" style="width:${p}%; background:${col}; box-shadow:0 0 15px ${col}"></div></div></div><div class="mt-6 flex gap-2 relative z-10 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition-opacity translate-y-0 lg:translate-y-2 lg:group-hover:translate-y-0"><button onclick="handlers.addGoalFund('${g.id}')" class="flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 text-xs font-bold text-white transition-all">+ Tabung</button><button onclick="handlers.deleteItem('goal','${g.id}')" class="px-3 rounded-xl bg-white/5 hover:bg-danger/10 border border-white/10 hover:border-danger/30 text-textMuted hover:text-danger transition-all"><i class="fa-solid fa-trash"></i></button></div><div class="absolute -bottom-10 -right-10 w-48 h-48 opacity-10 blur-3xl rounded-full group-hover:opacity-20 transition-all duration-700" style="background:${col}"></div></div>`;
                });
            },
            renderBudget: () => {
                const lim = settings.budgetLimit; const now = new Date();
                const sp = db.transactions.filter(t => t.type==='expense' && new Date(t.date).getMonth()===now.getMonth()).reduce((a,b)=>a+b.amount,0);
                document.getElementById('budget-spent-display').innerText = utils.formatIDR(sp);
                const b=document.getElementById('budget-progress'), w=document.getElementById('budget-warning');
                if(lim > 0) { document.getElementById('budget-limit-display').innerText = utils.formatIDR(lim); const p=Math.min(100,(sp/lim)*100); b.style.width=p+'%'; b.className=`h-full transition-all duration-1000 ease-out ${p>=100?'bg-danger shadow-[0_0_15px_rgba(220,38,38,0.5)]':p>=80?'bg-warning shadow-[0_0_15px_rgba(217,119,6,0.5)]':'bg-success shadow-[0_0_15px_rgba(5,150,105,0.5)]'}`; w.classList.toggle('hidden',p<80); w.innerHTML=p>=100?'<i class="fa-solid fa-circle-exclamation mr-1"></i> OVER BUDGET DETECTED':'<i class="fa-solid fa-triangle-exclamation mr-1"></i> MENGHAMPIRI BATAS'; }
                else { document.getElementById('budget-limit-display').innerText="Unlimited"; b.style.width='0%'; w.classList.add('hidden'); }
            },
            renderSettings: () => {
                const hp = !!settings.security.pin;
                const btn = document.getElementById('btn-toggle-pin'); const stat = document.getElementById('setting-pin-status');
                if(hp) { stat.innerText="Sistem Terproteksi"; stat.className="text-xs text-success font-bold mt-1"; btn.innerText="Hapus PIN"; btn.className="px-5 py-2.5 rounded-xl bg-danger/10 border border-danger/30 text-xs font-bold text-danger hover:bg-danger/20 transition-all"; document.getElementById('bio-settings-card').classList.remove('opacity-50'); }
                else { stat.innerText="Belum diatur"; stat.className="text-xs text-textMuted mt-1"; btn.innerText="Atur PIN"; btn.className="px-5 py-2.5 rounded-xl bg-primary/10 border border-primary/30 text-xs font-bold text-primary hover:bg-primary/20 transition-all"; document.getElementById('bio-settings-card').classList.add('opacity-50'); }
                document.getElementById('toggle-bio').checked = settings.security.bioEnabled;
            }
        }

        function saveBudget() { const raw = document.getElementById('budget-limit-input').value; settings.budgetLimit=utils.parseCurrency(raw)||0; utils.save(); ui.showToast('Limit Tersimpan'); ui.confetti(); }
        function hardReset() { security.verifyIdentity(() => { localStorage.removeItem(DB_KEY); localStorage.removeItem(SETTINGS_KEY); location.reload(); }, "Konfirmasi Reset Data (Permanen)"); }
        function exportDataToCSV() { handlers.exportFullCSV(); }

        window.addEventListener('DOMContentLoaded', app.init);
        document.addEventListener("DOMContentLoaded", () => { if(typeof autoAnimate !== 'undefined') { autoAnimate(document.getElementById('transaction-table-body')); autoAnimate(document.getElementById('dash-recent-list')); autoAnimate(document.getElementById('transaction-mobile-list')); } });
    </script>
</body>
</html>
